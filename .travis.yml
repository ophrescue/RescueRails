dist: bionic
language: ruby
cache:
- bundler
sudo: required
rvm:
- 2.5.1
bundler_args: "--without production"
addons:
  postgresql: '9.6'
  firefox: latest
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable
env:
  global:
  - ARTIFACTS_AWS_REGION=us-east-1
  - ARTIFACTS_S3_BUCKET=travis-ci-screenshots
  - secure: asNrPcYQTTHEvkbk9jK29a45gyZRQBGL54alP3784EIhLanJ+JuzY5p8zGEAAchU164QPRSb9b59Elvig97zIMFCyVrrppXQDDqCQBnnqnacHRUN20pd1huNlasgrIDHQpy23m3U/ncEeIRHg8yCjdrVcGYA1XjNFRYxLnEsiyw=
  - secure: LbLdKhEEj3VDtRYZspy1Uj6ZobCKDObGSe+1/GkrH2DqLvCBjwKe6W8lCQtWEr5yDTFMUcpekosEdvnBh1UTESyOMq1/aaWW+QknypxetOx9kk38ByrmKTcr3eNdbXZ9HutfHSkIDW7bXCtUX4yKdRPvnQa4QMxfjqG9h0TDCZ8=
  - secure: rcR1gQNXATBnUMuE9bY3NgR0QvKinn8DB01CQ3eM4rKt4e4X4dxEcGkUP5R7v9OpinrIypZnuj6EaRaDECf8yQlHthhBxqajplgiNBNSD8sXBJxM0NSJRMixRgYa8ayXYU40mTSyRC7LM2jnjMSxEevbXwaDvtXk1tz2o7BS0UE=
  - secure: 4gX6Y5WzqsMnpLFxiL2J1csH/EWx6VAfiKGwS/AGN/9MSJMS4UU2l6Cof6E5asiqFOX4Zi1Q5Phfsn42wI5Ywr95i6spLp6pZyN4mBOFZ21j5ZKTlcyOZLKw0vr1xeA3zOgHOWcOVEe/eFCB2opVWRP1Q7ocBuHouN6V03OZHIk=
  matrix:
  - BROWSER=chrome_headless SUITE=spec/
  - BROWSER=firefox_headless SUITE=spec/features
script:
# - RAILS_ENV=test bundle exec rake db:migrate --trace
# - bundle exec rake db:test:prepare
# - BROWSER=$BROWSER bundle exec rspec $SUITE
before_install:
- wget https://github.com/mozilla/geckodriver/releases/download/v0.21.0/geckodriver-v0.21.0-linux64.tar.gz
- mkdir geckodriver
- tar -xzf geckodriver-v0.21.0-linux64.tar.gz -C geckodriver
- export PATH=$PATH:$PWD/geckodriver
before_script:
- psql -c 'create database travis_ci_test;' -U postgres
- cp config/database.yml.travis config/database.yml
- gem install travis-artifacts
after_success:
  - travis-artifacts help
after_failure:
# - travis-artifacts upload --path tmp/capybara/
  - travis-artifacts help
